(function(){var a,b,c,d,e,f,g;d=function(a,b){var c,d,e,f;f=[];for(d in b.prototype)try{e=b.prototype[d],null==a[d]&&"function"!=typeof e?f.push(a[d]=e):f.push(void 0)}catch(g){c=g}return f},a={},null==a.options&&(a.options={}),c={checks:{xhr:{url:function(){return"/offline-test-request/"+Math.floor(1e9*Math.random())}},image:{url:function(){return"http://dqakt69vkj09v.cloudfront.net/are-we-online.gif?_="+Math.floor(1e9*Math.random())}},active:"image"},checkOnLoad:!1,interceptRequests:!0,reconnect:!0},e=function(a,b){var c,d,e,f,g,h;for(c=a,f=b.split("."),d=g=0,h=f.length;h>g&&(e=f[d],c=c[e],"object"==typeof c);d=++g);return d===f.length-1?c:void 0},a.getOption=function(b){var d,f;return d=null!=(f=e(a.options,b))?f:e(c,b),"function"==typeof d?d():d},"function"==typeof window.addEventListener&&window.addEventListener("online",function(){return setTimeout(a.confirmUp,100)},!1),"function"==typeof window.addEventListener&&window.addEventListener("offline",function(){return a.confirmDown()},!1),a.state="up",a.markUp=function(){return a.trigger("confirmed-up"),"up"!==a.state?(a.state="up",a.trigger("up")):void 0},a.markDown=function(){return a.trigger("confirmed-down"),"down"!==a.state?(a.state="down",a.trigger("down")):void 0},f={},a.on=function(b,c,d){var e,g,h,i,j;if(g=b.split(" "),g.length>1){for(j=[],h=0,i=g.length;i>h;h++)e=g[h],j.push(a.on(e,c,d));return j}return null==f[b]&&(f[b]=[]),f[b].push([d,c])},a.off=function(a,b){var c,d,e,g,h;if(null!=f[a]){if(b){for(d=0,h=[];d<f[a].length;)g=f[a][d],c=g[0],e=g[1],e===b?h.push(f[a].splice(d,1)):h.push(d++);return h}return f[a]=[]}},a.trigger=function(a){var b,c,d,e,g,h,i;if(null!=f[a]){for(g=f[a],i=[],d=0,e=g.length;e>d;d++)h=g[d],b=h[0],c=h[1],i.push(c.call(b));return i}},b=function(a,b,c){var d,e;return d=function(){return a.status&&a.status<12e3?b():c()},null===a.onprogress?(a.addEventListener("error",c,!1),a.addEventListener("timeout",c,!1),a.addEventListener("load",d,!1)):(e=a.onreadystatechange,a.onreadystatechange=function(){return 4===a.readyState?d():0===a.readyState&&c(),"function"==typeof e?e.apply(null,arguments):void 0})},a.checks={},a.checks.xhr=function(){var c,d;d=new XMLHttpRequest,d.offline=!1,d.open("HEAD",a.getOption("checks.xhr.url"),!0),b(d,a.markUp,a.markDown);try{d.send()}catch(e){c=e,a.markDown()}return d},a.checks.image=function(){var b;return b=document.createElement("img"),b.onerror=a.markDown,b.onload=a.markUp,b.src=a.getOption("checks.image.url"),void 0},a.check=function(){return a.trigger("checking"),a.checks[a.getOption("checks.active")]()},a.confirmUp=a.confirmDown=a.check,a.onXHR=function(a){var b,c,e;return b=function(b,c){var d;return d=b.open,b.open=function(e,f,g,h,i){return a({type:e,url:f,async:g,flags:c,user:h,password:i,xhr:b}),d.apply(b,arguments)}},e=window.XMLHttpRequest,window.XMLHttpRequest=function(a){var c,d,f;return c=new e(a),b(c,a),f=c.setRequestHeader,c.headers={},c.setRequestHeader=function(a,b){return c.headers[a]=b,f.call(c,a,b)},d=c.overrideMimeType,c.overrideMimeType=function(a){return c.mimeType=a,d.call(c,a)},c},d(window.XMLHttpRequest,e),null!=window.XDomainRequest?(c=window.XDomainRequest,window.XDomainRequest=function(){var a;return a=new c,b(a),a},d(window.XDomainRequest,c)):void 0},g=function(){return a.getOption("interceptRequests")&&a.onXHR(function(c){var d;return d=c.xhr,d.offline!==!1?b(d,a.confirmUp,a.confirmDown):void 0}),a.getOption("checkOnLoad")?a.check():void 0},setTimeout(g,0),window.Offline=a}).call(this),function(){var a,b,c,d,e,f,g,h,i;if(!window.Offline)throw new Error("Offline Reconnect brought in without offline.js");d=Offline.reconnect={},f=null,e=function(){var a;return null!=d.state&&"inactive"!==d.state&&Offline.trigger("reconnect:stopped"),d.state="inactive",d.remaining=d.delay=null!=(a=Offline.getOption("reconnect.initialDelay"))?a:3},b=function(){var a,b;return a=null!=(b=Offline.getOption("reconnect.delay"))?b:Math.min(Math.ceil(1.5*d.delay),3600),d.remaining=d.delay=a},g=function(){return"connecting"!==d.state?(d.remaining-=1,Offline.trigger("reconnect:tick"),0===d.remaining?h():void 0):void 0},h=function(){return"waiting"===d.state?(Offline.trigger("reconnect:connecting"),d.state="connecting",Offline.check()):void 0},a=function(){return Offline.getOption("reconnect")?(e(),d.state="waiting",Offline.trigger("reconnect:started"),f=setInterval(g,1e3)):void 0},i=function(){return null!=f&&clearInterval(f),e()},c=function(){return Offline.getOption("reconnect")?"connecting"===d.state?(Offline.trigger("reconnect:failure"),d.state="waiting",b()):void 0:void 0},d.tryNow=h,e(),Offline.on("down",a),Offline.on("confirmed-down",c),Offline.on("up",i)}.call(this),function(){var a,b,c,d,e,f;if(!window.Offline)throw new Error("Requests module brought in without offline.js");c=[],f=!1,d=function(a){return Offline.trigger("requests:capture"),"down"!==Offline.state&&(f=!0),c.push(a)},e=function(a){var b,c,d,e,f,g,h,i,j;i=a.xhr,f=a.url,e=a.type,g=a.user,d=a.password,b=a.body,i.abort(),i.open(e,f,!0,g,d),j=i.headers;for(c in j)h=j[c],i.setRequestHeader(c,h);return i.mimeType&&i.overrideMimeType(i.mimeType),i.send(b)},a=function(){return c=[]},b=function(){var b,d,f,g,h,i;for(Offline.trigger("requests:flush"),f={},h=0,i=c.length;i>h;h++)d=c[h],g=d.url.replace(/(\?|&)_=[0-9]+/,function(a,b){return"?"===b?b:""}),f[""+d.type.toUpperCase()+" - "+g]=d;for(b in f)d=f[b],e(d);return a()},setTimeout(function(){return Offline.getOption("requests")!==!1?(Offline.on("confirmed-up",function(){return f?(f=!1,a()):void 0}),Offline.on("up",b),Offline.on("down",function(){return f=!1}),Offline.onXHR(function(a){var b,c,e,f,g;return e=a.xhr,b=a.async,e.offline!==!1&&(c=function(){return d(a)},g=e.send,e.send=function(b){return a.body=b,g.apply(e,arguments)},b)?null===e.onprogress?(e.addEventListener("error",c,!1),e.addEventListener("timeout",c,!1)):(f=e.onreadystatechange,e.onreadystatechange=function(){return 0===e.readyState?c():4===e.readyState&&(0===e.status||e.status>=12e3)&&c(),"function"==typeof f?f.apply(null,arguments):void 0}):void 0}),Offline.requests={flush:b,clear:a}):void 0},0)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!window.Offline)throw new Error("Offline UI brought in without offline.js");b='<div class="offline-ui"><div class="offline-ui-content"></div></div>',a='<a href class="offline-ui-retry"></a>',e=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.children[0]},f=d=null,c=function(a){return k(a),f.className+=" "+a},k=function(a){return f.className=f.className.replace(new RegExp("(^| )"+a.split(" ").join("|")+"( |$)","gi")," ")},h={},g=function(a,b){return c(a),null!=h[a]&&clearTimeout(h[a]),h[a]=setTimeout(function(){return k(a),delete h[a]},1e3*b)},i=function(a,b){var c,d,e,f,g,h;if(null==b&&(b=!1),0===a)return"now";c={d:86400,h:3600,m:60,s:1},d={s:"second",m:"minute",h:"hour",d:"day"},f="";for(g in c)if(e=c[g],a>=e)return h=Math.floor(a/e),b&&(g=" "+d[g],1!==h&&(g+="s")),""+h+g},l=function(){var g,h;return f=e(b),document.body.appendChild(f),null!=Offline.reconnect&&Offline.getOption("reconnect")&&(f.appendChild(e(a)),g=f.querySelector(".offline-ui-retry"),h=function(a){return a.preventDefault(),Offline.reconnect.tryNow()},null!=g.addEventListener?g.addEventListener("click",h,!1):g.attachEvent("click",h)),c("offline-ui-"+Offline.state),d=f.querySelector(".offline-ui-content")},j=function(){return l(),Offline.on("up",function(){return k("offline-ui-down"),c("offline-ui-up"),g("offline-ui-up-2s",2),g("offline-ui-up-5s",5)}),Offline.on("down",function(){return k("offline-ui-up"),c("offline-ui-down"),g("offline-ui-down-2s",2),g("offline-ui-down-5s",5)}),Offline.on("reconnect:connecting",function(){return c("offline-ui-connecting"),k("offline-ui-waiting")}),Offline.on("reconnect:tick",function(){return c("offline-ui-waiting"),k("offline-ui-connecting"),d.setAttribute("data-retry-in-seconds",Offline.reconnect.remaining),d.setAttribute("data-retry-in-abbr",i(Offline.reconnect.remaining)),d.setAttribute("data-retry-in",i(Offline.reconnect.remaining,!0))}),Offline.on("reconnect:stopped",function(){return k("offline-ui-connecting offline-ui-waiting"),d.setAttribute("data-retry-in-seconds",null),d.setAttribute("data-retry-in-abbr",null),d.setAttribute("data-retry-in",null)}),Offline.on("reconnect:failure",function(){return g("offline-ui-reconnect-failed-2s",2),g("offline-ui-reconnect-failed-5s",5)}),Offline.on("reconnect:success",function(){return g("offline-ui-reconnect-succeeded-2s",2),g("offline-ui-reconnect-succeeded-5s",5)})},"complete"===document.readyState?j():null!=document.addEventListener?document.addEventListener("DOMContentLoaded",j,!1):(m=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&j(),"function"==typeof m?m.apply(null,arguments):void 0})}.call(this);var pubsub=pubsub||{};!function(a){a.notification=a.notification||{},a.notification.subscribers=[],a.notification.log=[],a.notification.subscribe=function(b,c,d,e){a.notification.subscribers[b]||(a.notification.subscribers[b]={});var f=a.notification.subscribers[b];f[c]={},f[c].response=d,f[c].responseParams=e||null,a.notification.log.push({type:"subscribe",notification:b,subscriber:c})},a.notification.unsubscribe=function(b,c){a.notification.subscribers[b]&&a.notification.subscribers[b][c]&&(delete a.notification.subscribers[b][c],a.notification.log.push({type:"unsubscribe",notification:b,unsubscriber:c}))},a.notification.publish=function(b,c,d){if(a.notification.subscribers[b]){d=d||"unidentified";var e=a.notification.subscribers[b],f=[];for(var g in e){var h={};h.notificationParams=c||null,h.responseParams=a.notification.subscribers[b][g].responseParams||null,setTimeout(function(a,b){return function(){e[a].response(b)}}(g,h),0),f.push(g)}a.notification.log.push({type:"publish",notification:b,informedSubscribers:f,publisher:d})}}}(pubsub);var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,e=[],b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)e[j]=0|a[b+j];else{var k=e[j-3]^e[j-8]^e[j-14]^e[j-16];e[j]=k<<1|k>>>31}k=(d<<5|d>>>27)+i+e[j],k=20>j?k+((f&g|~f&h)+1518500249):40>j?k+((f^g^h)+1859775393):60>j?k+((f&g|f&h|g&h)-1894007588):k+((f^g^h)-899497514),i=h,h=g,g=f<<30|f>>>2,f=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+f|0,c[2]=c[2]+g|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(b),a.HmacSHA1=d._createHmacHelper(b)}(),imeiapp={},imeiapp.ui={},imeiapp.DOM={},imeiapp.utils={},imeiapp.stats={},imeiapp.animate={},imeiapp.network={},imeiapp.currentInvoice={},imeiapp.stats.step=0,imeiapp.currentInvoice.invoice="",imeiapp.currentInvoice.imeis=[],imeiapp.pubsub=pubsub.notification,imeiapp.network.intervals={},imeiapp.DOM.backBtn=document.getElementsByClassName("previousStep"),imeiapp.DOM.nextBtn=document.getElementsByClassName("nextStep"),imeiapp.DOM.startRegistration=document.getElementById("start-registration"),imeiapp.DOM.cancelRegistration=document.getElementsByClassName("restart"),imeiapp.DOM.connectionIndicator=document.getElementsByClassName("connection-indicator"),imeiapp.DOM.invoiceNumberSlots=document.getElementsByClassName("invoiceNumber"),imeiapp.DOM.IMEIsForReview=document.getElementsByClassName("imeiForReview"),imeiapp.DOM.imeiTallySlots=document.getElementsByClassName("imeiTally"),imeiapp.DOM.editSavedIMEIs=document.getElementById("editSavedIMEIs"),imeiapp.DOM.invoice=document.getElementById("invoice"),imeiapp.DOM.IMEI=document.getElementById("IMEI"),imeiapp.DOM.saveIMEI=document.getElementById("addIMEItoInvoice"),imeiapp.DOM.imeiReviewList=document.getElementById("imeiReviewList"),imeiapp.DOM.completeRegistration=document.getElementById("finish-registration"),imeiapp.DOM.screens=document.getElementsByClassName("fullscreen"),imeiapp.ui.activateScreen=function(a){var b=imeiapp,c=b.DOM.screens,d=b.utils.addClass;d(c[a],"active")},imeiapp.ui.deactivateScreen=function(a){var b=imeiapp,c=b.DOM.screens,d=b.utils.removeClass;d(c[a],"active")},imeiapp.utils.sha1=function(a){var b=CryptoJS.SHA1(a);return b.toString()},imeiapp.utils.utf8=function(a){if(null===a||"undefined"==typeof a)return"";var b,c,d=a+"",e="",f=0;b=c=0,f=d.length;for(var g=0;f>g;g++){var h=d.charCodeAt(g),i=null;if(128>h)c++;else if(h>127&&2048>h)i=String.fromCharCode(h>>6|192,63&h|128);else if(h&!0)i=String.fromCharCode(h>>12|224,h>>6&63|128,63&h|128);else{if(h&!0)throw new RangeError("Unmatched trail surrogate at "+g);var j=d.charCodeAt(++g);if(j&!0)throw new RangeError("Unmatched lead surrogate at "+(g-1));h=((1023&h)<<10)+(1023&j)+65536,i=String.fromCharCode(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}null!==i&&(c>b&&(e+=d.slice(b,c)),e+=i,b=c=g+1)}return c>b&&(e+=d.slice(b,f)),e},imeiapp.utils.easeInOutQuad=function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},imeiapp.utils.onResize=function(a,b){return onresize=function(){clearTimeout(b),b=setTimeout(a,250)},a},imeiapp.utils.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},imeiapp.utils.addClass=function(a,b){imeiapp.utils.hasClass(a,b)||(a.className+=" "+b)},imeiapp.utils.removeClass=function(a,b){if(imeiapp.utils.hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},imeiapp.utils.toggleClass=function(a,b){imeiapp.utils.hasClass(a,b)?imeiapp.utils.removeClass(a,b):imeiapp.utils.addClass(a,b)},imeiapp.utils.launchApp=function(){var a=imeiapp,b=a.DOM,c=a.utils,d=a.pubsub,e=a.network,f=d.publish;window.localStorage.registrations||c.createRegistrationStorage(),window.localStorage.transactions||c.createTransactionStorage(),window.localStorage.archives||c.createArchiveStorage(),"up"===e.networkState()?f("network-up",null,this):f("network-down",null,this),b.setScreensHeight(),c.gotoScreen(0)},imeiapp.utils.cacheReady=function(){alert("App Has Been Updated and will Restart Now"),window.applicationCache.swapCache(),location.reload(!0)},imeiapp.utils.cacheDownloading=function(){imeiapp.utils.gotoScreen(0),imeiapp.utils.deactivateActiveScreen(),alert("Downloading App Updates - Sorry for the Wait")},imeiapp.utils.createStorage=function(a,b){return b=b||"[]",window.localStorage[a]?!1:(window.localStorage[a]=b,!0)},imeiapp.utils.createTransactionStorage=function(){return imeiapp.utils.createStorage("transactions","{}")},imeiapp.utils.createRegistrationStorage=function(){return imeiapp.utils.createStorage("registrations")},imeiapp.utils.createArchiveStorage=function(){return imeiapp.utils.createStorage("archives","{}")},imeiapp.utils.getStorage=function(a){var b=imeiapp,c=window.localStorage,d=b.utils,e=c[a],f=d.utf8(e);return JSON.parse(f)},imeiapp.utils.getRegistrationStorage=function(){return imeiapp.utils.getStorage("registrations")},imeiapp.utils.getTransactionStorage=function(){return imeiapp.utils.getStorage("transactions")},imeiapp.utils.getArchiveStorage=function(){return imeiapp.utils.getStorage("archives")},imeiapp.utils.storeRegistration=function(a){if("[object Object]"!==Object.prototype.toString.call(a))return!1;var b=imeiapp.utils.getRegistrationStorage();return b.push(a),window.localStorage.registrations=JSON.stringify(b),!0},imeiapp.utils.storeTransaction=function(){var a=imeiapp.utils,b=a.sha1,c=a.utf8,d=a.getTransactionStorage(),e=JSON.stringify(a.getRegistrationStorage()),f=c(e).replace(/"/g,'\\"'),g=b('"'+f+'"');return d[g]=e,window.localStorage.transactions=JSON.stringify(d),delete window.localStorage.registrations,imeiapp.utils.createRegistrationStorage(),g},imeiapp.utils.getTransaction=function(a){var b=imeiapp.utils,c=b.getTransactionStorage();return c[a]},imeiapp.utils.archiveTransaction=function(a){if(!a)return!1;var b=imeiapp.utils,c=b.getArchiveStorage(),d=b.getTransactionStorage();return c[a]=d[a],delete d[a],window.localStorage.transactions=JSON.stringify(d),window.localStorage.archives=JSON.stringify(c),!0},imeiapp.utils.deleteArchiveEntry=function(a){if(!a)return!1;var b=imeiapp.utils,c=b.getArchiveStorage();return delete c[a],window.localStorage.archives=JSON.stringify(c),console.log("deleted transaction #"+a+" from archives"),!0},imeiapp.utils.deactivateActiveScreen=function(){imeiapp.pubsub.publish("screen-teardown",null,this)},imeiapp.utils.activateScreen=function(a){imeiapp.pubsub.publish("screen-"+a+"-setup",null,this)},imeiapp.utils.gotoScreen=function(a){imeiapp.utils.deactivateActiveScreen(),imeiapp.stats.step=a,imeiapp.utils.activateScreen(imeiapp.stats.step)},imeiapp.utils.gotoNextScreen=function(){imeiapp.utils.gotoScreen(imeiapp.stats.step+1)},imeiapp.utils.gotoPreviousScreen=function(){imeiapp.utils.gotoScreen(imeiapp.stats.step-1)},imeiapp.utils.updateListOfIMEIs=function(){var a=imeiapp.DOM.imeiReviewList,b="";a.innerHTML="";for(var c=0;c<imeiapp.currentInvoice.imeis.length;c++)b=b+"<span class='imeiForReview'>"+imeiapp.currentInvoice.imeis[c]+"</span>"+(c<imeiapp.currentInvoice.imeis.length-1?" | ":"");a.innerHTML=b,imeiapp.DOM.activateIMEIsForReview()},imeiapp.utils.updateInvoiceNumberReferences=function(){for(var a=imeiapp.DOM.invoiceNumberSlots.length-1;a>=0;a--)imeiapp.DOM.invoiceNumberSlots[a].innerHTML="#"+imeiapp.DOM.invoice.value},imeiapp.utils.reviewIMEI=function(a){if(0>a)return console.log("no index given to review for reviewIMEI()"),void 0;var b=imeiapp.currentInvoice.imeis[a],c=confirm("Is this IMEI ("+b+") Correct?");if(c!==!0){var d=b,e=prompt("Submit the Correct IMEI to Update or Submit a Blank Field to Delete '"+d+"'",d),f=function(){imeiapp.currentInvoice.imeis[a]=e,alert("'"+d+"' has been replaced with '"+e+"'")},g=function(){alert("'"+d+"' has not been changed or deleted")},h=function(){var b=confirm("Are you sure you want to delete '"+d+"'?");return b!==!0?(alert("'"+d+"' has not been deleted or modified"),void 0):(imeiapp.currentInvoice.imeis.splice(a,1),alert("'"+d+"' has been deleted"),void 0)};e===d||null===e?g():""===e?h():f(),imeiapp.pubsub.publish("imei-tally-updated",null,this)}},imeiapp.animate.scrollTo=function(){var a,b,c;return function(d,e){function f(){var d;c=(Date.now()-b)/e,c>=1&&(clearInterval(a),c=1),d=c*h+g,window.scrollBy(0,d-window.pageYOffset)}var g=window.pageYOffset,h=d-window.pageYOffset;return e=e||400,b=Date.now(),c=0,a&&clearInterval(a),a=setInterval(f,10)}}(),imeiapp.animate.scrollToActiveScreen=function(){imeiapp.animate.scrollTo(imeiapp.DOM.screens[imeiapp.stats.step].offsetTop)};for(var i=imeiapp.DOM.cancelRegistration.length-1;i>=0;i--)imeiapp.DOM.cancelRegistration[i].addEventListener("click",function(){imeiapp.pubsub.publish("cancel-registration",null,this)});imeiapp.utils.onResize(function(){imeiapp.pubsub.publish("windowResized",null,this)}),imeiapp.pubsub.subscribe("imei-tally-updated","tally-slots-updater",function(){for(var a=imeiapp.DOM.imeiTallySlots,b=imeiapp.currentInvoice.imeis.length,c=a.length-1;c>=0;c--)a[c].innerHTML=b},null),imeiapp.pubsub.subscribe("registration-completed","reset-app-on-success",function(){alert("Registration Complete! \n\nApp is Ready to Process a New Registration"),imeiapp.pubsub.publish("cancel-registration",null,"reset-app-on-success")},null),imeiapp.pubsub.subscribe("invoice-number-updated","step-3-imei-list",imeiapp.utils.updateInvoiceNumberReferences,null),imeiapp.pubsub.subscribe("cancel-registration","restartBtn",function(){imeiapp.DOM.invoice.value=null,imeiapp.DOM.IMEI.value=null,imeiapp.currentInvoice.invoice="",imeiapp.currentInvoice.imeis=[],imeiapp.pubsub.publish("imei-tally-updated",null,this),imeiapp.utils.gotoScreen(0)},null),imeiapp.pubsub.subscribe("imei-tally-updated","gatekeeper",function(){var a=1;imeiapp.stats.step<=a||imeiapp.currentInvoice.imeis.length<1&&(alert("No IMEIs are currently attached. \n\nAdd at least 1 to Proceed"),imeiapp.utils.gotoScreen(a))},null),imeiapp.pubsub.subscribe("windowResized","windowSizeWatchdog",imeiapp.DOM.setScreensHeight,null),imeiapp.pubsub.subscribe("screensResized","autoScroller",imeiapp.animate.scrollToActiveScreen,null),imeiapp.pubsub.subscribe("screen-setup-complete","autoScroller",imeiapp.animate.scrollToActiveScreen,null),imeiapp.pubsub.subscribe("gotToScreen","activeScreenWatchdog",imeiapp.DOM.setScreensHeight,null),imeiapp.pubsub.subscribe("server-acknowledged-transaction","console.log",function(a){var b=a.notificationParams.server_transaction_id,c=a.notificationParams.client_transaction_id;b===c?console.log("server received transaction "+b):(console.log("something went wrong: client and server id don't match"),console.log(a.notificationParams))},null),imeiapp.pubsub.subscribe("screen-0-setup","handyman",function(){var a=imeiapp,b=a.pubsub,c=b.publish,d=b.subscribe,e=b.unsubscribe,f=0,g=function(){imeiapp.utils.gotoNextScreen()},h=function(a){13===a.keyCode&&imeiapp.DOM.startRegistration.click()},i=function(){imeiapp.DOM.startRegistration.addEventListener("click",g),window.addEventListener("keydown",h),imeiapp.ui.activateScreen(f),c("screen-setup-complete",null,"screen-"+f+"-setup")},j=function(){imeiapp.DOM.startRegistration.removeEventListener("click",g),window.removeEventListener("keydown",h),imeiapp.ui.deactivateScreen(f)};i(),d("screen-teardown","screen-0-setup",function(){j(),e("screen-teardown","screen-0-setup")},null)},null),imeiapp.pubsub.subscribe("screen-1-setup","handyman",function(){var a=imeiapp,b=a.DOM,c=a.utils,d=a.pubsub,e=c.addClass,f=c.removeClass,g=d.publish,h=d.subscribe,i=d.unsubscribe,j=1,k=b.screens[imeiapp.stats.step].getElementsByClassName("nextStep")[0],l=function(){return b.IMEI.value?(a.currentInvoice.imeis||(a.currentInvoice.imeis=[]),a.currentInvoice.imeis.push(b.IMEI.value),alert("'"+b.IMEI.value+"' has been stored"),g("imei-tally-updated",null,this),b.IMEI.value=null,b.IMEI.focus(),void 0):(alert("No IMEI Number to Store"),n(b.IMEI),void 0)},m=function(){for(var b=a.currentInvoice.imeis.length,d=0;d<a.currentInvoice.imeis.length;d++){var e=a.currentInvoice.imeis.length;c.reviewIMEI(d),e>a.currentInvoice.imeis.length&&(d-=e-a.currentInvoice.imeis.length)}0===a.currentInvoice.imeis.length&&alert("There are no IMEIs attached to this Invoice"),b!==a.currentInvoice.imeis.length&&g("imei-tally-updated",null,this)},n=function(a){e(a,"attention"),a.addEventListener("input",o)},o=function(){f(this,"attention"),this.removeEventListener("input",o)},p=function(c){13===c.keyCode&&(""===this.value&&a.currentInvoice.imeis.length>0?k.click():b.saveIMEI.click())},q=function(){a.currentInvoice.imeis.length>0?f(k,"invisible"):e(k,"invisible")},r=function(){b.saveIMEI.addEventListener("click",l),b.editSavedIMEIs.addEventListener("click",m),b.IMEI.addEventListener("keydown",p),q(),h("imei-tally-updated","screen-"+j+"-next-btn",q,null),a.ui.activateScreen(j),b.IMEI.focus(),g("screen-setup-complete",null,"screen-"+j+"-setup")},s=function(){b.saveIMEI.removeEventListener("click",l),b.editSavedIMEIs.removeEventListener("click",m),b.IMEI.removeEventListener("keydown",p),i("imei-tally-updated","screen-"+j+"-next-btn"),a.ui.deactivateScreen(j)};r(),h("screen-teardown","screen-"+j+"-setup",function(){s(),i("screen-teardown","screen-"+j+"-setup")},null)},null),imeiapp.pubsub.subscribe("screen-2-setup","handyman",function(){var a=imeiapp,b=a.DOM,c=a.utils,d=a.pubsub,e=c.addClass,f=c.removeClass,g=d.publish,h=d.subscribe,i=d.unsubscribe,j=2,k=b.screens[imeiapp.stats.step].getElementsByClassName("nextStep")[0],l=function(a){e(a,"attention"),a.addEventListener("input",inputFieldAttentionRemover)};inputFieldAttentionRemover=function(){f(this,"attention"),this.removeEventListener("input",inputFieldAttentionRemover)},saveInvoiceNumber=function(){return b.invoice.value?(imeiapp.currentInvoice.invoice=imeiapp.DOM.invoice.value,g("invoice-number-updated",null,this),alert("The Invoice Number is now '"+imeiapp.DOM.invoice.value+"'"),void 0):(alert("An Invoice Number is Needed to Continue"),l(b.invoice),void 0)},inputFieldEnterBtnLogic=function(b){13===b.keyCode&&(""!==this.value&&a.currentInvoice.invoice===this.value?k.click():saveInvoiceNumber())},setNextBtnVisibility=function(){a.currentInvoice.invoice&&""!==a.currentInvoice.invoice?f(k,"invisible"):e(k,"invisible")},screenSetup=function(){b.invoice.addEventListener("keydown",inputFieldEnterBtnLogic),setNextBtnVisibility(),h("invoice-number-updated","screen-"+j+"-next-btn",setNextBtnVisibility,null),a.ui.activateScreen(j),b.invoice.focus(),g("screen-setup-complete",null,"screen-"+j+"-setup")},screenTeardown=function(){b.invoice.removeEventListener("keydown",inputFieldEnterBtnLogic),i("invoice-number-updated","screen-"+j+"-next-btn"),a.ui.deactivateScreen(j)},screenSetup(),h("screen-teardown","screen-"+j+"-setup",function(){screenTeardown(),i("screen-teardown","screen-"+j+"-setup")},null)},null),imeiapp.pubsub.subscribe("screen-3-setup","handyman",function(){var a=imeiapp,b=a.DOM,c=a.utils,d=a.pubsub,e=(c.addClass,c.removeClass,d.publish),f=d.subscribe,g=d.unsubscribe,h=3,i=b.completeRegistration,j=function(){c.storeRegistration(a.currentInvoice),e("registration-completed",null,this)},k=function(){for(var a=b.imeiReviewList,c="",d=0;d<imeiapp.currentInvoice.imeis.length;d++)c=c+"<span class='imeiForReview'>"+imeiapp.currentInvoice.imeis[d]+"</span>"+(d<imeiapp.currentInvoice.imeis.length-1?" | ":"");a.innerHTML=c,imeiapp.DOM.activateIMEIsForReview()},l=function(a){13===a.keyCode&&j()},m=function(){i.addEventListener("click",j),window.addEventListener("keydown",l),f("imei-tally-updated","imei-list-updater",imeiapp.utils.updateListOfIMEIs,null),k(),a.ui.activateScreen(h),e("screen-setup-complete",null,"screen-"+h+"-setup")},n=function(){i.removeEventListener("click",j),window.removeEventListener("keydown",l),g("imei-tally-updated","imei-list-updater"),a.ui.deactivateScreen(h)};m(),f("screen-teardown","screen-"+h+"-setup",function(){n(),g("screen-teardown","screen-"+h+"-setup")},null)},null),document.addEventListener("touchmove",function(a){a.preventDefault()}),imeiapp.DOM.setScreensHeight=function(){for(var a=imeiapp.DOM.screens.length-1;a>=0&&!(a<imeiapp.stats.step);a--)imeiapp.DOM.screens[a].style.height=window.innerHeight+"px";imeiapp.pubsub.publish("screensResized",null,"screenResizer")},imeiapp.DOM.activateIMEIsForReview=function(){for(var a=imeiapp.DOM.IMEIsForReview,b=a.length-1;b>=0;b--)a[b].addEventListener("click",function(){var a=b;return function(){imeiapp.utils.reviewIMEI(a)}}())};for(var i=imeiapp.DOM.backBtn.length-1;i>=0;i--)imeiapp.DOM.backBtn[i].addEventListener("click",function(){imeiapp.utils.gotoScreen(imeiapp.stats.step-1)});for(var i=imeiapp.DOM.nextBtn.length-1;i>=0;i--)imeiapp.DOM.nextBtn[i].addEventListener("click",function(){imeiapp.utils.gotoScreen(imeiapp.stats.step+1)});window.applicationCache&&(window.applicationCache.addEventListener("downloading",imeiapp.utils.cacheDownloading),window.applicationCache.addEventListener("updateready",imeiapp.utils.cacheReady)),Offline.options={checkOnLoad:!0,interceptRequests:!1,requests:!1,checks:{active:"xhr",xhr:{url:"server-check.php"}}},imeiapp.network.networkState=function(){return Offline.state},imeiapp.network.checkNetworkState=function(){Offline.check()},imeiapp.network.setOnlineState=function(){var a=imeiapp.utils,b=document.body;a.removeClass(b,"connection-offline"),a.addClass(b,"connection-online")},imeiapp.network.setOfflineState=function(){var a=imeiapp.utils,b=document.body;a.removeClass(b,"connection-online"),a.addClass(b,"connection-offline")},imeiapp.network.pushRegistrations=function(){var a=imeiapp,b=a.utils,c=a.network,d=b.storeTransaction();return c.sendTransaction(d),!0},imeiapp.network.sendTransaction=function(a){if(!a)return!1;var b=imeiapp.pubsub.publish,c=imeiapp.network.POST,d=imeiapp.utils,e=d.utf8,f=d.getTransaction(a),g=JSON.stringify(f),h=e(g),i=function(c){var d={};d.server_transaction_id=c,d.client_transaction_id=a,b("server-acknowledged-transaction",d,"sendTransaction")},j=c(location.href+"process-transaction.php","t="+h,i);return j},imeiapp.network.checkTransactionStatus=function(){var a=imeiapp.pubsub.publish,b=imeiapp.network.POST,c=imeiapp.utils,d=[],e=c.getTransactionStorage(),f=function(b){var c=JSON.parse(b);a("transaction-status-received",c,"checkTransactionStatus")};for(var g in e)e.hasOwnProperty(g)&&d.push(g);d=JSON.stringify(d),b(location.href+"transaction-status-check.php","t="+d,f)},imeiapp.network.confirmArchivedTransactions=function(){var a=imeiapp,b=a.utils,c=(a.network.POST,a.pubsub.publish),d=[],e=b.getArchiveStorage(),f=function(a){var b=JSON.parse(a);c("transactions-confirmed",b,"confirmArchivedTransactions")
};for(var g in e)e.hasOwnProperty(g)&&d.push(g);d=JSON.stringify(d),imeiapp.network.POST(location.href+"confirm-transaction.php","t="+d,f)},imeiapp.network.POST=function(a,b,c,d){if(!a)return!1;var e=new XMLHttpRequest;return b=b||"",c=c||function(b){console.log("POST TO "+a+" SUCCESSFUL! \nRESPONSE: "+b)},d=d||function(b){console.log("POST TO "+a+" UNSUCCESSFUL. \nXMLHTTP OBJECT:"),console.log(b)},e.open("POST",a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&(e.status>199&&e.status<400?c(e.responseText):d(e))},e.send(b),!0},imeiapp.pubsub.subscribe("transaction-status-received","process-transaction-status",function(a){var b=a.notificationParams,c=[];for(var d in b)b.hasOwnProperty(d)&&("false"!==b[d]?"processed"!==b[d]||c.push(d):imeiapp.network.sendTransaction(d));c.length>0&&imeiapp.pubsub.publish("transactions-to-archive",c,"process-transaction-status")},null),imeiapp.pubsub.subscribe("transactions-to-archive","archive-keeper",function(a){for(var b=a.notificationParams,c=b.length-1;c>=0;c--){var d=imeiapp.utils.archiveTransaction(b[c]);console.log("archive transaction #"+b[c]+": "+d)}imeiapp.pubsub.publish("transactions-archived",null,"archive-keeper")},null),imeiapp.pubsub.subscribe("transactions-archived","confirm-transactions",function(){var a=imeiapp.utils.getArchiveStorage();for(var b in a)if(a.hasOwnProperty(b)){console.log("now confirming transactions on server"),imeiapp.network.confirmArchivedTransactions();break}},null),imeiapp.pubsub.subscribe("transactions-confirmed","archive-keeper",function(a){{var b=a.notificationParams;imeiapp.utils.getArchiveStorage()}console.log("collection of confirmed transactions"),console.log(b);for(var c in b)b.hasOwnProperty(c)&&imeiapp.utils.deleteArchiveEntry(c)},null),imeiapp.pubsub.subscribe("network-reconnecting","light-flicker",function(){var a=imeiapp.utils,b=imeiapp.DOM.connectionIndicator;imeiapp.network.checkingLightFlickerInterval=setInterval(function(){for(var c=b.length-1;c>=0;c--)a.addClass(b[c],"connection-checking"),setTimeout(function(){var d=c;return function(){a.removeClass(b[d],"connection-checking")}}(),350)},2e3),imeiapp.pubsub.subscribe("network-reconnecting-exit","light-flicker",function(){clearInterval(imeiapp.network.checkingLightFlickerInterval),imeiapp.pubsub.unsubscribe("network-reconnecting-exit","light-flicker")},null)},null),imeiapp.pubsub.subscribe("network-up","online-indicator",imeiapp.network.setOnlineState,null),imeiapp.pubsub.subscribe("network-down","online-indicator",imeiapp.network.setOfflineState,null),imeiapp.pubsub.subscribe("network-up","heartbeat",function(){var a=imeiapp.network,b=imeiapp.pubsub,c=a.intervals,d=b.subscribe,e=b.unsubscribe,f=function(){a.checkNetworkState()},g=function(){clearInterval(c.heartbeat),delete c.heartbeat};c.heartbeat=setInterval(f,7500),d("network-down","heartbeat",function(){g(),e("network-down","heartbeat")},null)},null),imeiapp.pubsub.subscribe("network-up","confirm-transactions",function(){var a=imeiapp,b=a.network,c=window.localStorage,d=a.pubsub,e=b.intervals,f=d.subscribe,g=d.unsubscribe,h=function(){if(c&&c.archives&&JSON.parse(c.archives)){var a=imeiapp.utils.getArchiveStorage();for(var d in a)if(a.hasOwnProperty(d)){b.confirmArchivedTransactions();break}}},i=function(){clearInterval(e.confirmArchivedTransactions),delete e.confirmArchivedTransactions};h(),e.confirmArchivedTransactions=setInterval(h,54e4),f("network-down","confirm-transactions",function(){i(),g("network-down","confirm-transactions")},null)},null),imeiapp.pubsub.subscribe("network-up","check-transaction-status",function(){var a=imeiapp,b=a.pubsub,c=a.network,d=window.localStorage,e=c.intervals,f=b.subscribe,g=b.unsubscribe,h=function(){if(d&&d.transactions&&JSON.parse(d.transactions)){var a=imeiapp.utils.getTransactionStorage();for(var b in a)if(a.hasOwnProperty(b)){c.checkTransactionStatus();break}}},i=function(){clearInterval(e.transactionStatusCheck),delete e.transactionStatusCheck};h(),e.transactionStatusCheck=setInterval(h,6e5),f("network-down","check-transaction-status",function(){i(),g("network-down","check-transaction-status")},null)},null),imeiapp.pubsub.subscribe("network-up","push-registrations-to-server",function(){var a=imeiapp,b=a.pubsub,c=a.network,d=window.localStorage,e=c.intervals,f=b.subscribe,g=b.unsubscribe,h=function(){d&&d.registrations&&JSON.parse(d.registrations)&&!(JSON.parse(d.registrations).length<1)&&c.pushRegistrations()},i=function(){clearInterval(e.pushRegistrations),delete e.pushRegistrations};h(),e.pushRegistrations=setInterval(h,66e4),f("network-down","push-registrations-to-server",function(){i(),g("network-down","push-registrations-to-server")},null)},null),Offline.on("up",function(){imeiapp.pubsub.publish("network-up",null,"connection-watchdog")}),Offline.on("down",function(){imeiapp.pubsub.publish("network-down",null,"connection-watchdog")}),Offline.on("reconnect:started",function(){imeiapp.pubsub.publish("network-reconnecting",null,"connection-watchdog")}),Offline.on("reconnect:stopped",function(){imeiapp.pubsub.publish("network-reconnecting-exit",null,"connection-watchdog")}),document.addEventListener("DOMContentLoaded",function(){imeiapp.utils.launchApp()});