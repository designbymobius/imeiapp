var pubsub=pubsub||{};!function(a){a.notification=a.notification||{},a.notification.subscribers=[],a.notification.log=[],a.notification.subscribe=function(b,c,d,e){a.notification.subscribers[b]||(a.notification.subscribers[b]={});var f=a.notification.subscribers[b];f[c]={},f[c].response=d,f[c].responseParams=e||null,a.notification.log.push({type:"subscribe",notification:b,subscriber:c})},a.notification.unsubscribe=function(b,c){a.notification.subscribers[b]&&a.notification.subscribers[b][c]&&(delete a.notification.subscribers[b][c],a.notification.log.push({type:"unsubscribe",notification:b,unsubscriber:c}))},a.notification.publish=function(b,c,d){if(a.notification.subscribers[b]){var d=d||"unidentified",e=a.notification.subscribers[b],f=[];for(var g in e){var h={};h.notificationParams=c||null,h.responseParams=a.notification.subscribers[b][g].responseParams||null,setTimeout(function(a,b){return function(){e[a].response(b)}}(g,h),0),f.push(g)}a.notification.log.push({type:"publish",notification:b,informedSubscribers:f,publisher:d})}}}(pubsub);var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,e=[],b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)e[j]=0|a[b+j];else{var k=e[j-3]^e[j-8]^e[j-14]^e[j-16];e[j]=k<<1|k>>>31}k=(d<<5|d>>>27)+i+e[j],k=20>j?k+((f&g|~f&h)+1518500249):40>j?k+((f^g^h)+1859775393):60>j?k+((f&g|f&h|g&h)-1894007588):k+((f^g^h)-899497514),i=h,h=g,g=f<<30|f>>>2,f=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+f|0,c[2]=c[2]+g|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(b),a.HmacSHA1=d._createHmacHelper(b)}(),imeiapp={},imeiapp.DOM={},imeiapp.utils={},imeiapp.stats={},imeiapp.animate={},imeiapp.network={},imeiapp.currentInvoice={},imeiapp.storage=window.localStorage,imeiapp.stats.step=0,imeiapp.currentInvoice.invoice="",imeiapp.currentInvoice.imeis=[],imeiapp.pubsub=pubsub.notification,imeiapp.network.intervals={},imeiapp.DOM.startRegistration=document.getElementById("start-registration"),imeiapp.DOM.cancelRegistration=document.getElementsByClassName("restart"),imeiapp.DOM.connectionIndicator=document.getElementsByClassName("connection-indicator"),imeiapp.DOM.editInvoiceNumber=document.getElementsByClassName("editInvoiceNumber"),imeiapp.DOM.invoiceNumberSlots=document.getElementsByClassName("invoiceNumber"),imeiapp.DOM.IMEIsForReview=document.getElementsByClassName("imeiForReview"),imeiapp.DOM.imeiTallySlots=document.getElementsByClassName("imeiTally"),imeiapp.DOM.editInvoiceAttachments=document.getElementsByClassName("editInvoiceAttachments"),imeiapp.DOM.editSavedIMEIs=document.getElementById("editSavedIMEIs"),imeiapp.DOM.invoice=document.getElementById("invoice"),imeiapp.DOM.IMEI=document.getElementById("IMEI"),imeiapp.DOM.addIMEI=document.getElementById("addIMEI"),imeiapp.DOM.saveIMEI=document.getElementById("addIMEItoInvoice"),imeiapp.DOM.reviewInvoice=document.getElementById("reviewInvoice"),imeiapp.DOM.imeiReviewList=document.getElementById("imeiReviewList"),imeiapp.DOM.completeRegistration=document.getElementById("finish-registration"),imeiapp.DOM.screens=document.getElementsByClassName("fullscreen"),imeiapp.utils.sha1=function(a){var b=CryptoJS.SHA1(a);return b.toString()},imeiapp.utils.utf8=function(a){if(null===a||"undefined"==typeof a)return"";var b,c,d=a+"",e="",f=0;b=c=0,f=d.length;for(var g=0;f>g;g++){var h=d.charCodeAt(g),i=null;if(128>h)c++;else if(h>127&&2048>h)i=String.fromCharCode(h>>6|192,63&h|128);else if(h&!0)i=String.fromCharCode(h>>12|224,h>>6&63|128,63&h|128);else{if(h&!0)throw new RangeError("Unmatched trail surrogate at "+g);var j=d.charCodeAt(++g);if(j&!0)throw new RangeError("Unmatched lead surrogate at "+(g-1));h=((1023&h)<<10)+(1023&j)+65536,i=String.fromCharCode(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}null!==i&&(c>b&&(e+=d.slice(b,c)),e+=i,b=c=g+1)}return c>b&&(e+=d.slice(b,f)),e},imeiapp.utils.easeInOutQuad=function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},imeiapp.utils.onResize=function(a,b){return onresize=function(){clearTimeout(b),b=setTimeout(a,250)},a},imeiapp.utils.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},imeiapp.utils.addClass=function(a,b){imeiapp.utils.hasClass(a,b)||(a.className+=" "+b)},imeiapp.utils.removeClass=function(a,b){if(imeiapp.utils.hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},imeiapp.utils.toggleClass=function(a,b){imeiapp.utils.hasClass(a,b)?imeiapp.utils.removeClass(a,b):imeiapp.utils.addClass(a,b)},imeiapp.utils.activeScreenIndex=function(){for(var a=imeiapp.DOM.screens,b=imeiapp.utils.hasClass,c=a.length-1;c>=0;c--)if(b(a[c],"active"))return c},imeiapp.utils.launchApp=function(){{var a=imeiapp,b=a.DOM,c=a.utils,d=a.pubsub,e=a.storage,f=a.network,g=d.publish;e.registrations}e.registrations||c.createRegistrationStorage(),e.transactions||c.createTransactionStorage(),e.archives||c.createArchiveStorage(),"up"==f.networkState()?g("network-up",null,this):g("network-down",null,this),b.setScreensHeight(),c.gotoScreen(0)},imeiapp.utils.cacheReady=function(){alert("App Has Been Updated and will Restart Now"),window.applicationCache.swapCache(),location.reload(!0)},imeiapp.utils.cacheDownloading=function(){imeiapp.utils.gotoScreen(0),imeiapp.utils.deactivateActiveScreen(),alert("Downloading App Updates - Sorry for the Wait")},imeiapp.utils.createStorage=function(a,b){var c=imeiapp.storage,d=a,b=b||"[]";return c[a]?!1:(console.log(" # "+d.toUpperCase()+" DB NOT FOUND\n --> creating it @ imeiapp.storage."+d),c[a]=b,!0)},imeiapp.utils.createTransactionStorage=function(){return imeiapp.utils.createStorage("transactions","{}")},imeiapp.utils.createRegistrationStorage=function(){return imeiapp.utils.createStorage("registrations")},imeiapp.utils.createArchiveStorage=function(){return imeiapp.utils.createStorage("archives","{}")},imeiapp.utils.getStorage=function(a){var b=imeiapp,c=b.storage,d=b.utils,e=c[a],f=d.utf8(e);return JSON.parse(f)},imeiapp.utils.getRegistrationStorage=function(){return imeiapp.utils.getStorage("registrations")},imeiapp.utils.getTransactionStorage=function(){return imeiapp.utils.getStorage("transactions")},imeiapp.utils.getArchiveStorage=function(){return imeiapp.utils.getStorage("archives")},imeiapp.utils.storeRegistration=function(a){if("[object Object]"!=Object.prototype.toString.call(a))return!1;var b=imeiapp.utils.getRegistrationStorage();return b.push(a),imeiapp.storage.registrations=JSON.stringify(b),!0},imeiapp.utils.storeTransaction=function(){var a=imeiapp.utils,b=a.sha1,c=a.utf8,d=a.getTransactionStorage(),e=JSON.stringify(a.getRegistrationStorage()),f=c(e).replace(/"/g,'\\"'),g=b('"'+f+'"');return d[g]=e,imeiapp.storage.transactions=JSON.stringify(d),delete imeiapp.storage.registrations,imeiapp.utils.createRegistrationStorage(),g},imeiapp.utils.getTransaction=function(a){var b=imeiapp.utils,c=b.getTransactionStorage();return c[a]},imeiapp.utils.archiveTransaction=function(a){if(!a)return!1;var b=imeiapp.utils,c=b.getArchiveStorage(),d=b.getTransactionStorage();return c[a]=d[a],delete d[a],imeiapp.storage.archives=JSON.stringify(c),imeiapp.storage.transactions=JSON.stringify(d),!0},imeiapp.utils.deleteArchiveEntry=function(a){if(!a)return!1;var b=imeiapp.utils,c=b.getArchiveStorage();return delete c[a],console.log("deleted transaction #"+a+" from archives"),imeiapp.storage.archives=JSON.stringify(c),!0},imeiapp.animate.scrollTo=function(){var a,b,c;return function(d,e){function f(){var d;c=(Date.now()-b)/e,c>=1&&(clearInterval(a),c=1),d=c*h+g,window.scrollBy(0,d-window.pageYOffset)}var g=window.pageYOffset,h=d-window.pageYOffset;return e=e||400,b=Date.now(),c=0,a&&clearInterval(a),a=setInterval(f,10)}}(),imeiapp.DOM.startRegistration.addEventListener("click",function(){imeiapp.pubsub.publish("start-registration",null,this)}),imeiapp.DOM.addIMEI.addEventListener("click",function(){imeiapp.pubsub.publish("add-imei",null,this)}),imeiapp.DOM.saveIMEI.addEventListener("click",function(){imeiapp.pubsub.publish("save-imei",null,this)}),imeiapp.DOM.editSavedIMEIs.addEventListener("click",function(){imeiapp.pubsub.publish("edit-imei",null,this)}),imeiapp.DOM.reviewInvoice.addEventListener("click",function(){imeiapp.pubsub.publish("reviewInvoice",null,this)}),imeiapp.DOM.completeRegistration.addEventListener("click",function(){imeiapp.pubsub.publish("save-registration",null,this)}),imeiapp.utils.savedIMEIsTally=function(){imeiapp.pubsub.publish("imei-tally",null,this)},imeiapp.DOM.editSavedIMEIs.addEventListener("click",function(){for(var a=0;a<imeiapp.currentInvoice.imeis.length;a++){var b=imeiapp.currentInvoice.imeis.length;imeiapp.utils.reviewIMEI(a),b>imeiapp.currentInvoice.imeis.length&&(a-=1)}0==imeiapp.currentInvoice.imeis.length&&alert("There are no IMEIs attached to this Invoice"),imeiapp.utils.savedIMEIsTally()});for(var i=imeiapp.DOM.cancelRegistration.length-1;i>=0;i--)imeiapp.DOM.cancelRegistration[i].addEventListener("click",function(){imeiapp.pubsub.publish("cancel-registration",null,this)});for(var i=imeiapp.DOM.editInvoiceNumber.length-1;i>=0;i--)imeiapp.DOM.editInvoiceNumber[i].addEventListener("click",function(){imeiapp.pubsub.publish("edit-invoice",null,this)});for(var i=imeiapp.DOM.editInvoiceAttachments.length-1;i>=0;i--)imeiapp.DOM.editInvoiceAttachments[i].addEventListener("click",function(){imeiapp.pubsub.publish("edit-invoice-attachments",null,this)});imeiapp.utils.onResize(function(){imeiapp.pubsub.publish("windowResized",null,this)}),imeiapp.pubsub.subscribe("start-registration","step-0",function(){imeiapp.utils.gotoScreen(1),imeiapp.DOM.invoice.focus()},null),imeiapp.pubsub.subscribe("add-imei","step-1",function(){if(!imeiapp.DOM.invoice.value)return alert("An Invoice Number is Needed to Continue"),imeiapp.utils.addClass(imeiapp.DOM.invoice,"attention"),imeiapp.DOM.invoice.addEventListener("input",function(){imeiapp.utils.removeClass(imeiapp.DOM.invoice,"attention"),imeiapp.DOM.invoice.removeEventListener("input",arguments.callee)}),void 0;imeiapp.currentInvoice.invoice=imeiapp.DOM.invoice.value;for(var a=imeiapp.DOM.invoiceNumberSlots.length-1;a>=0;a--)imeiapp.DOM.invoiceNumberSlots[a].innerHTML="#"+imeiapp.DOM.invoice.value;imeiapp.utils.gotoScreen(2),imeiapp.DOM.IMEI.focus()},null),imeiapp.pubsub.subscribe("save-imei","step-2",function(){return imeiapp.DOM.IMEI.value?(imeiapp.currentInvoice.imeis||(imeiapp.currentInvoice.imeis=[]),imeiapp.currentInvoice.imeis.push(imeiapp.DOM.IMEI.value),alert("'"+imeiapp.DOM.IMEI.value+"' has been added to Invoice #"+imeiapp.currentInvoice.invoice),imeiapp.utils.savedIMEIsTally(),imeiapp.DOM.IMEI.value=null,imeiapp.DOM.IMEI.focus(),void 0):(alert("No IMEI Number to Store"),imeiapp.utils.addClass(imeiapp.DOM.IMEI,"attention"),imeiapp.DOM.IMEI.addEventListener("input",function(){imeiapp.utils.removeClass(this,"attention"),this.removeEventListener("input",arguments.callee)}),void 0)},null),imeiapp.pubsub.subscribe("imei-tally","step-2-progress-btn",function(){var a=imeiapp.DOM.reviewInvoice,b=imeiapp.utils.addClass,c=imeiapp.utils.removeClass,d=imeiapp.currentInvoice.imeis.length;d>0?b(a,"active"):c(a,"active")},null),imeiapp.pubsub.subscribe("imei-tally","tally-slots-updater",function(){for(var a=imeiapp.DOM.imeiTallySlots,b=imeiapp.currentInvoice.imeis.length,c=a.length-1;c>=0;c--)a[c].innerHTML=b},null),imeiapp.pubsub.subscribe("reviewInvoice","step-2",function(){imeiapp.utils.gotoScreen(3)},null),imeiapp.pubsub.subscribe("save-registration","final-step",function(){var a=imeiapp.utils.storeRegistration(imeiapp.currentInvoice);0!=a&&imeiapp.pubsub.publish("registration-completed",null,"final-step")},null),imeiapp.pubsub.subscribe("registration-completed","reset-app-on-success",function(){alert("Registration Complete! \n\nApp is Ready to Process a New Registration"),imeiapp.pubsub.publish("cancel-registration",null,"reset-app-on-success")},null),imeiapp.pubsub.subscribe("imei-tally","step-3-imei-list",function(){imeiapp.utils.updateListOfIMEIs()},null),imeiapp.pubsub.subscribe("cancel-registration","restartBtn",function(){imeiapp.DOM.invoice.value=null,imeiapp.DOM.IMEI.value=null,imeiapp.currentInvoice.invoice="",imeiapp.currentInvoice.imeis=[],imeiapp.utils.savedIMEIsTally(),imeiapp.utils.gotoScreen(0)},null),imeiapp.pubsub.subscribe("edit-invoice","editInvoiceBtn",function(){imeiapp.utils.gotoScreen(1),imeiapp.DOM.invoice.select()},null),imeiapp.pubsub.subscribe("edit-invoice-attachments","step-3-back-btn",function(){imeiapp.utils.gotoScreen(2),imeiapp.DOM.IMEI.select()},null),imeiapp.pubsub.subscribe("imei-tally","step-3-bouncer",function(){var a=imeiapp.utils.activeScreenIndex();3==a&&imeiapp.currentInvoice.imeis.length<1&&(alert("No IMEIs are currently attached to Invoice #"+imeiapp.currentInvoice.invoice+". \n\nAdd at least 1 to Proceed"),imeiapp.utils.gotoScreen(2),imeiapp.DOM.IMEI.select())},null),imeiapp.pubsub.subscribe("windowResized","windowSizeWatchdog",function(){imeiapp.DOM.setScreensHeight()},null),imeiapp.pubsub.subscribe("screensResized","autoScroller",function(){imeiapp.animate.scrollTo(imeiapp.DOM.screens[imeiapp.stats.step].offsetTop)},null),imeiapp.pubsub.subscribe("gotToScreen","activeScreenWatchdog",function(){imeiapp.DOM.setScreensHeight()},null),document.addEventListener("touchmove",function(a){a.preventDefault()}),imeiapp.DOM.invoice.addEventListener("keydown",function(a){13==a.keyCode&&imeiapp.DOM.addIMEI.click()}),imeiapp.DOM.IMEI.addEventListener("keydown",function(a){13==a.keyCode&&imeiapp.DOM.saveIMEI.click()}),imeiapp.DOM.setScreensHeight=function(){for(var a=imeiapp.DOM.screens.length-1;a>=0&&!(a<imeiapp.stats.step);a--)imeiapp.DOM.screens[a].style.height=window.innerHeight+"px";imeiapp.pubsub.publish("screensResized",null,"screenResizer")},imeiapp.utils.deactivateActiveScreen=function(){imeiapp.utils.removeClass(imeiapp.DOM.screens[imeiapp.stats.step],"active")},imeiapp.utils.activateScreen=function(a){imeiapp.utils.addClass(a,"active")},imeiapp.utils.gotoScreen=function(a,b){var b=b||400;imeiapp.utils.deactivateActiveScreen(),imeiapp.stats.step=a;var c=imeiapp.DOM.screens[imeiapp.stats.step];imeiapp.utils.activateScreen(c),imeiapp.animate.scrollTo(c.offsetTop,b),setTimeout(function(){imeiapp.pubsub.publish("gotToScreen",null,"gotoScreen")},b+10)},imeiapp.utils.updateListOfIMEIs=function(){var a=imeiapp.DOM.imeiReviewList,b="";a.innerHTML="";for(var c=0;c<imeiapp.currentInvoice.imeis.length;c++)var b=b+"<span class='imeiForReview'>"+imeiapp.currentInvoice.imeis[c]+"</span>"+(c<imeiapp.currentInvoice.imeis.length-1?" | ":"");a.innerHTML=b,imeiapp.DOM.activateIMEIsForReview()},imeiapp.utils.reviewIMEI=function(a){if(0>a)return console.log("no index given to review for reviewIMEI()"),void 0;var b=imeiapp.currentInvoice.imeis[a],c=confirm("Is this IMEI ("+b+") Correct?");if(c!==!0){var d=b,e=prompt("Submit the Correct IMEI to Update or Submit a Blank Field to Delete '"+d+"'",d),f=function(){imeiapp.currentInvoice.imeis[a]=e,alert("'"+d+"' has been replaced with '"+e+"'")},g=function(){alert("'"+d+"' has not been changed or deleted")},h=function(){var b=confirm("Are you sure you want to delete '"+d+"'?");return b!==!0?(alert("'"+d+"' has not been deleted or modified"),void 0):(imeiapp.currentInvoice.imeis.splice(a,1),alert("'"+d+"' has been deleted"),void 0)};e==d||null==e?g():""==e?h():f(),imeiapp.utils.savedIMEIsTally()}},imeiapp.DOM.activateIMEIsForReview=function(){for(var a=imeiapp.DOM.IMEIsForReview,b=a.length-1;b>=0;b--)a[b].addEventListener("click",function(){var a=b;return function(){imeiapp.utils.reviewIMEI(a)}}())},window.applicationCache&&(window.applicationCache.addEventListener("downloading",imeiapp.utils.cacheDownloading),window.applicationCache.addEventListener("updateready",imeiapp.utils.cacheReady)),Offline.options={checkOnLoad:!0,interceptRequests:!1,requests:!1,checks:{active:"xhr",xhr:{url:"server-check.php"}}},imeiapp.network.networkState=function(){return Offline.state},imeiapp.network.checkNetworkState=function(){Offline.check()},imeiapp.network.setOnlineState=function(){var a=imeiapp.utils,b=document.body;a.removeClass(b,"connection-offline"),a.addClass(b,"connection-online")},imeiapp.network.setOfflineState=function(){var a=imeiapp.utils,b=document.body;a.removeClass(b,"connection-online"),a.addClass(b,"connection-offline")},imeiapp.network.pushRegistrations=function(){var a=imeiapp,b=a.utils,c=a.network,d=b.storeTransaction();return c.sendTransaction(d),!0},imeiapp.network.sendTransaction=function(a){if(!a)return!1;var b=imeiapp.pubsub.publish,c=imeiapp.network.POST,d=imeiapp.utils,e=d.utf8,f=d.getTransaction(a),g=JSON.stringify(f),h=e(g);POST_success=function(c){var d={};d.server_transaction_id=c,d.client_transaction_id=a,b("server-acknowledged-transaction",d,"sendTransaction")};var i=c(location.href+"process-transaction.php","t="+h,POST_success);return i},imeiapp.network.checkTransactionStatus=function(){var a=imeiapp.pubsub.publish,b=imeiapp.network.POST,c=imeiapp.utils,d=[],e=c.getTransactionStorage(),f=function(b){var c=JSON.parse(b);a("transaction-status-received",c,"checkTransactionStatus")};for(var g in e)e.hasOwnProperty(g)&&d.push(g);d=JSON.stringify(d),b(location.href+"transaction-status-check.php","t="+d,f)},imeiapp.network.confirmArchivedTransactions=function(){var a=imeiapp,b=a.utils,c=(a.network.POST,a.pubsub.publish),d=[],e=b.getArchiveStorage(),f=function(a){var b=JSON.parse(a);c("transactions-confirmed",b,"confirmArchivedTransactions")};for(var g in e)e.hasOwnProperty(g)&&d.push(g);d=JSON.stringify(d),imeiapp.network.POST(location.href+"confirm-transaction.php","t="+d,f)},imeiapp.network.POST=function(a,b,c,d){if(!a)return!1;var b=b||"",c=c||function(b){console.log("POST TO "+a+" SUCCESSFUL! \nRESPONSE: "+b)},d=d||function(b){console.log("POST TO "+a+" UNSUCCESSFUL. \nXMLHTTP OBJECT:"),console.log(b)},e=new XMLHttpRequest;return e.open("POST",a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&(e.status>199&&e.status<400?c(e.responseText):d(e))},e.send(b),!0},imeiapp.pubsub.subscribe("server-acknowledged-transaction","console.log",function(a){var b=a.notificationParams.server_transaction_id,c=a.notificationParams.client_transaction_id;b==c?console.log("server received transaction "+b):(console.log("something went wrong: client and server id don't match"),console.log(a.notificationParams))},null),imeiapp.pubsub.subscribe("transaction-status-received","process-transaction-status",function(a){var b=a.notificationParams,c=[];for(var d in b)b.hasOwnProperty(d)&&("false"!=b[d]?"processed"!=b[d]||c.push(d):imeiapp.network.sendTransaction(d));c.length>0&&imeiapp.pubsub.publish("transactions-to-archive",c,"process-transaction-status")},null),imeiapp.pubsub.subscribe("transactions-to-archive","archive-keeper",function(a){for(var b=a.notificationParams,c=b.length-1;c>=0;c--){var d=imeiapp.utils.archiveTransaction(b[c]);console.log("archive transaction #"+b[c]+": "+d)}imeiapp.pubsub.publish("transactions-archived",null,"archive-keeper")},null),imeiapp.pubsub.subscribe("transactions-archived","confirm-transactions",function(){var a=imeiapp.utils.getArchiveStorage();for(var b in a)if(a.hasOwnProperty(b)){console.log("now confirming transactions on server"),imeiapp.network.confirmArchivedTransactions();break}},null),imeiapp.pubsub.subscribe("transactions-confirmed","archive-keeper",function(a){{var b=a.notificationParams;imeiapp.utils.getArchiveStorage()}console.log("collection of confirmed transactions"),console.log(b);for(var c in b)b.hasOwnProperty(c)&&imeiapp.utils.deleteArchiveEntry(c)},null),Offline.on("up",function(){imeiapp.pubsub.publish("network-up",null,"connection-watchdog")}),Offline.on("down",function(){imeiapp.pubsub.publish("network-down",null,"connection-watchdog")}),Offline.on("reconnect:started",function(){imeiapp.pubsub.publish("network-reconnecting",null,"connection-watchdog")}),Offline.on("reconnect:stopped",function(){imeiapp.pubsub.publish("network-reconnecting-exit",null,"connection-watchdog")}),imeiapp.pubsub.subscribe("network-reconnecting","light-flicker",function(){var a=imeiapp.utils,b=imeiapp.DOM.connectionIndicator;imeiapp.network.checkingLightFlickerInterval=setInterval(function(){for(var c=b.length-1;c>=0;c--)a.addClass(b[c],"connection-checking"),setTimeout(function(){var d=c;return function(){a.removeClass(b[d],"connection-checking")}}(),350)},2e3),imeiapp.pubsub.subscribe("network-reconnecting-exit","light-flicker",function(){clearInterval(imeiapp.network.checkingLightFlickerInterval),imeiapp.pubsub.unsubscribe("network-reconnecting-exit","light-flicker")},null)},null),imeiapp.pubsub.subscribe("network-up","online-indicator",function(){imeiapp.network.setOnlineState()},null),imeiapp.pubsub.subscribe("network-down","online-indicator",function(){imeiapp.network.setOfflineState()},null),imeiapp.pubsub.subscribe("network-up","heartbeat",function(){var a=imeiapp.network,b=imeiapp.pubsub,c=a.intervals,d=b.subscribe,e=b.unsubscribe,f=function(){a.checkNetworkState()},g=function(){clearInterval(c.heartbeat),delete c.heartbeat};c.heartbeat=setInterval(f,7500),d("network-down","heartbeat",function(){g(),e("network-down","heartbeat")},null)},null),imeiapp.pubsub.subscribe("network-up","confirm-transactions",function(){var a=imeiapp,b=a.network,c=a.storage,d=a.pubsub,e=b.intervals,f=d.subscribe,g=d.unsubscribe,h=function(){if(c&&c.archives&&JSON.parse(c.archives)){var a=imeiapp.utils.getArchiveStorage();for(var d in a)if(a.hasOwnProperty(d)){b.confirmArchivedTransactions();break}}},i=function(){clearInterval(e.confirmArchivedTransactions),delete e.confirmArchivedTransactions};h(),e.confirmArchivedTransactions=setInterval(h,54e4),f("network-down","confirm-transactions",function(){i(),g("network-down","confirm-transactions")},null)},null),imeiapp.pubsub.subscribe("network-up","check-transaction-status",function(){var a=imeiapp,b=a.pubsub,c=a.network,d=a.storage,e=c.intervals,f=b.subscribe,g=b.unsubscribe,h=function(){if(d&&d.transactions&&JSON.parse(d.transactions)){var a=imeiapp.utils.getTransactionStorage();for(var b in a)if(a.hasOwnProperty(b)){c.checkTransactionStatus();break}}},i=function(){clearInterval(e.transactionStatusCheck),delete e.transactionStatusCheck};h(),e.transactionStatusCheck=setInterval(h,6e5),f("network-down","check-transaction-status",function(){i(),g("network-down","check-transaction-status")},null)},null),imeiapp.pubsub.subscribe("network-up","push-registrations-to-server",function(){var a=imeiapp,b=a.pubsub,c=a.network,d=a.storage,e=c.intervals,f=b.subscribe,g=b.unsubscribe,h=function(){d&&d.registrations&&JSON.parse(d.registrations)&&!(JSON.parse(d.registrations).length<1)&&c.pushRegistrations()},i=function(){clearInterval(e.pushRegistrations),delete e.pushRegistrations};h(),e.pushRegistrations=setInterval(h,66e4),f("network-down","push-registrations-to-server",function(){i(),g("network-down","push-registrations-to-server")},null)},null),document.addEventListener("DOMContentLoaded",function(){imeiapp.utils.launchApp()});